<html>
  <head>
    <title>SportsTweet</title>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
    <%= javascript_include_tag "http://localhost:9292/faye.js" %>
    <%= javascript_include_tag "jquery.slides.min.js" %>
  </head>
  <body>
    <div class="container">

      <!--INTRODUCTION -->
      <div class="left-col">
        <img src="http://i.imgur.com/KCLVHYX.png" alt="" class="logo" />
        <div class="tweet-info">
        <p>We show you the hottest topics in professional basketball on Twitter. Using <span class="num_tweets"><%= num_tweets %></span> tweets from the past <span class="elapsed_minutes"><%= elapsed_minutes %></span> minutes.</p>
          <p>Created by:<br> Rich Chang (<a href="http://twitter.com/richhchang" target="_blank_">@richhchang</a>),<br> Donald Leonard (<a href="http://twitter.com/Mr_2FirstNames" target="_blank_">@Mr_2FirstNames</a>), <br>and Sheng Wu (<a href="http://twitter.com/shenghis" target="_blank_">@shenghis</a>).</p>
        </div>
      </div>

      <!-- PICTURES -->
      <div id="slides">
        <% get_pictures.each do |pic| %>
          <div class="slide">
            <%= image_tag pic.media %>
            <div class="caption">
              <%= pic.text %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- TEAM CHART -->
      <div class="popular">
        <h3>Most mentioned teams:</h3>
        <svg class="chart"></svg>
      </div>

      <!-- PLAYER CHART -->
      <div class="popular">
        <h3>Most mentioned players:</h3>
        <svg class="chart2"></svg>
      </div>


      <!-- TWEET STREAMING -->
      <div class="tweet_container">
        <h3>Tweets about the NBA:</h3>
        <div class="tweets">
          <% get_six_tweets.each do |tweet| %>
            <div class="tweet"><%= tweet.text %></div>
          <% end %>
        </div>
      </div>
    </div>


    <!--TEAM JAVASCRIPT -->
    <script type="text/javascript">
        // Function for using format strings
        if (!String.prototype.format) {
          String.prototype.format = function() {
            var args = arguments;
            return this.replace(/{(\d+)}/g, function(match, number) { 
              return typeof args[number] != 'undefined'
                ? args[number]
                : match
              ;
            });
          };
        }

        // Set up initial bar graph
        var w = 400,
            h = 400,
            colors = d3.scale.category20();
     
        var data = [
            <% show_popular_teams.each do |team, count| %>
              {"label":"<%= team %>", "value": <%= count %>},
            <% end %>
        ];
        var values = data.map(function(d, i) { return d.value; });
        var barHeight = h / data.length;

        var x = d3.scale.linear()
                  .domain([0, d3.max(values)])
                  .range([0, w]);
     
        var chart = d3.select(".chart")
                      .attr("width", w)
                      .attr("height", h)

        chart.selectAll("rect")
             .data(values)
             .enter().append("rect")
             .attr("y", function(d, i) { return i*barHeight; })
             .attr("width", x)
             .attr("height", barHeight)
             .style("fill", function(d, i) { return colors(i); });

        chart.selectAll("text")
             .data(values)
             .enter().append("text")
             .attr("x", 10)
             .attr("y", function(d, i) { return (i+0.5)*barHeight; })
             .attr("dx", -3)
             .attr("dy", ".35em")
             .attr("class", function(d, i) { return data[i].label; })
             .text(function(d, i) { 
                 return "{0} ({1} mentions)".format(data[i].label, d); 
             });

    </script>

    <!--PLAYER JAVASCRIPT -->
    <script type="text/javascript">
        // Function for using format strings
        if (!String.prototype.format) {
          String.prototype.format = function() {
            var args = arguments;
            return this.replace(/{(\d+)}/g, function(match, number) { 
              return typeof args[number] != 'undefined'
                ? args[number]
                : match
              ;
            });
          };
        }

        // Set up initial bar graph
        var w = 400,
            h = 400,
            colors = d3.scale.category20c();
     
        var data = [
            <% show_popular_players.each do |team, count| %>
              {"label":"<%= team %>", "value": <%= count %>},
            <% end %>
        ];
        var values = data.map(function(d, i) { return d.value; });
        var barHeight = h / data.length;

        var x = d3.scale.linear()
                  .domain([0, d3.max(values)])
                  .range([0, w]);
     
        var chart = d3.select(".chart2")
                      .attr("width", w)
                      .attr("height", h)
                      .append("g");

        chart.selectAll("rect")
             .data(values)
             .enter().append("rect")
             .attr("y", function(d, i) { return i*barHeight; })
             .attr("width", x)
             .attr("height", barHeight)
             .style("fill", function(d, i) { return colors(i); });

        chart.selectAll("text")
             .data(values)
             .enter().append("text")
             .attr("x", 10)
             .attr("y", function(d, i) { return (i+0.5)*barHeight; })
             .attr("dx", -3)
             .attr("dy", ".35em")
             .attr("class", function(d, i) { return data[i].label; })
             .text(function(d, i) { 
                 return "{0} ({1} mentions)".format(data[i].label, d); 
             });

    </script>
  </body>
</html>
